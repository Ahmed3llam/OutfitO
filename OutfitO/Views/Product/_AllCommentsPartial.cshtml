@using Microsoft.AspNetCore.Identity;
@model List<Comment>
@inject UserManager<User> UserManager // Inject UserManager service

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
<link href="~/lib/bootstrap/dist/css/bootstrap.css" rel="stylesheet" />
@{
    Random random = new Random();
}


@foreach (var comment in Model)
{
    <!-- Reviews -->
    <div class="col-md-6">
        <div id="allcomment">
            <ul class="reviews">
                <li>
                    <div class="review-heading">
                        <h5 class="name">
                            @{
                                var user = await UserManager.FindByIdAsync(comment.UserId);
                                var firstName = user?.FirstName ?? "Unknown";
                                @firstName
                            }
                        </h5> <!-- Display user's first name -->
                        <p class="date">@DateTime.Now.AddDays(-random.Next(1, 365)).ToString("MMM dd, yyyy, h:mm tt")</p> <!-- Display random creation time -->

                        <div class="review-rating">
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star-o empty"></i>
                        </div>
                    </div>
                    <div class="review-body">
                        @comment.Body
                        <div class="comment-wrapper">
                            <div class="comment-actions">
                                <a href="/product/Editcomment?commentId=@comment.Id" class="edit-comment" data-comment-id="@comment.Id">
                                    <i class="bi bi-pencil-square"></i> Edit
                                </a>
                                <form action="/product/DeleteComment" method="post" class="delete-form">
                                    <input type="hidden" name="commentId" value="@comment.Id" />
                                    <button type="submit" class="btn btn-danger"> <i class="bi bi-x-circle-fill"></i> Delete</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
        </div>


    </div>

    <!-- /Reviews -->
}
<style>
    .comment-actions {
        float: left;
        display: block;
    }

        .comment-actions form, .comment-actions a {
            display: inline-block;
        }
</style>


@section Scripts {
    <script>
        $(function () {
            $('.edit-comment').click(function () {
                var commentId = $(this).data('comment-id');
                $.get('/product/EditComment?commentId=' + commentId, function (response) {
                    $('#editCommentModalBody').html(response);
                    $('#editCommentModal').modal('show');
                });
            });

            $('.delete-form').submit(function (event) {
                event.preventDefault();

                var form = this;

                Swal.fire({
                    title: 'Are you sure?',
                    text: 'Are you sure you want to delete this comment?',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'Yes, delete it!',
                    cancelButtonText: 'No, cancel'
                }).then((result) => {
                    if (result.isConfirmed) {
                        form.submit();
                    } else if (result.dismiss === Swal.DismissReason.cancel) {
                        Swal.fire(
                            'Cancelled!',
                            'The comment is safe :)',
                            'error'
                        );
                    }
                });
            });
        });
    </script>
}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
<script src="~/lib/jquery/dist/jquery.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.js"></script>
