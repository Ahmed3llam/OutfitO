@using Microsoft.AspNetCore.Identity;
@model List<Comment>
@inject UserManager<User> UserManager // Inject UserManager service

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
<link href="~/lib/bootstrap/dist/css/bootstrap.css" rel="stylesheet" />
@{
    Random random = new Random();
}

<div id="modal-placeholder"></div>
@foreach (var comment in Model)
{
    <!-- Reviews -->
    <div class="col-md-6">
        <div id="allcomment">
            <ul class="reviews">
                <li>
                    <div class="review-heading">
                        <h5 class="name">
                            @{
                                var user = await UserManager.FindByIdAsync(comment.UserId);
                                var firstName = user?.FirstName ?? "Unknown";
                                @firstName
                            }
                        </h5> <!-- Display user's first name -->
                        <p class="date">@DateTime.Now.AddDays(-random.Next(1, 365)).ToString("MMM dd, yyyy, h:mm tt")</p> <!-- Display random creation time -->

                        <div class="review-rating">
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star-o empty"></i>
                        </div>
                    </div>
                    <div class="review-body">                                          
                        <p>@comment.Body</p>
                         <p>
                            <a href="#" onclick="editeComment('@comment.Id')" class="edit-comment">
                            <i class="bi bi-pencil-square">Edite</i>
                        </a>

                        <form action="/product/DeleteComment" method="post" class="delete-form">
                            <input type="hidden" name="commentId" value="@comment.Id" />
                            <button type="submit"> <i class="bi bi-x-circle-fill"></i> </button>
                        </form>  
                         </p>                       
                    </div>
                </li>
            </ul>
        </div>
     
        
    </div>
    
    <!-- /Reviews -->
}

<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function editeComment(commentId)
    {
        event.preventDefault();
        $.ajax({
            url: '/product/EditComment?commentId=' + commentId,
            success: function (result) {
                console.log(result)
                $("#modal-placeholder").html(result);
                $('#EditModal').modal('show');
            }
        });
    }
</script>



<script>
    document.querySelectorAll('.delete-form').forEach(form => {
        form.addEventListener('submit', function (event) {
            event.preventDefault();


            Swal.fire({
                title: 'Are you sure?',
                text: 'Are you sure you want to delete this Course?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Yes, delete it!',
                cancelButtonText: 'No, cancel'
            }).then((result) => {
                if (result.isConfirmed) {

                    form.submit();

                } else if (result.dismiss === Swal.DismissReason.cancel) {
                    Swal.fire(
                        'Cancelled!',
                        'Course is safe :)',
                        'error'
                    );
                }
            });
        });
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
<script src="~/lib/jquery/dist/jquery.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.js"></script>
